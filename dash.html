<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Estratégico del Catálogo Global de Netflix</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 0; }
        .dashboard-container { display: flex; max-width: 1400px; margin: 20px auto; background-color: #fff; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border-radius: 10px; overflow: hidden; }
        .sidebar { width: 250px; background-color: #221f1f; color: white; padding: 20px; box-sizing: border-box; }
        .sidebar h3 { color: #e50914; margin-top: 0; border-bottom: 2px solid #e50914; padding-bottom: 10px; }
        .main-content { flex-grow: 1; padding: 20px; }
        .header { background-color: #e50914; color: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; text-align: center; }
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px; text-align: center; }
        .kpi-card { background-color: #f0f0f0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        .kpi-card h2 { font-size: 2em; margin: 0; color: #e50914; }
        .kpi-card p { margin: 5px 0 0; font-size: 0.9em; font-weight: bold; }
        .chart-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .chart-card { background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .filter-group { margin-bottom: 20px; }
        .filter-group label { display: block; margin-bottom: 5px; font-weight: bold; color: white; }
        .filter-group select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        /* Estilo para los filtros de género/país que suelen ser multiselect */
        .filter-group input[type="text"] { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-container { flex-direction: column; }
            .sidebar { width: 100%; }
            .chart-grid, .kpi-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <div class="sidebar">
            <h3>FILTROS</h3>

            <div class="filter-group">
                <label for="tipoFilter">Tipo de Contenido</label>
                <select id="tipoFilter">
                    <option value="All">Todos</option>
                    <option value="Movie">Películas</option>
                    <option value="TV Show">Programas de TV</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="publicoFilter">Clasificación (Público)</label>
                <select id="publicoFilter">
                    <option value="All">Todas las Clasificaciones</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="paisFilter">País de Producción</label>
                <select id="paisFilter">
                    <option value="All">Todos los Países</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="categoriaFilter">Categoría / Género</label>
                <select id="categoriaFilter">
                    <option value="All">Todos los Géneros</option>
                </select>
            </div>

            <button onclick="applyFilters()" style="width: 100%; padding: 10px; background-color: #e50914; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Aplicar Filtros</button>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>ANÁLISIS ESTRATÉGICO DEL CATÁLOGO GLOBAL DE NETFLIX</h1>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card">
                    <h2 id="kpi-total-titulos">0</h2>
                    <p>TOTAL DE TÍTULOS</p>
                </div>
                <div class="kpi-card">
                    <h2 id="kpi-porcentaje-movies">0%</h2>
                    <p>% DE PELÍCULAS</p>
                </div>
                <div class="kpi-card">
                    <h2 id="kpi-duracion-promedio">0 min</h2>
                    <p>DURACIÓN PROMEDIO (Películas)</p>
                </div>
                <div class="kpi-card">
                    <h2 id="kpi-pais-top">N/A</h2>
                    <p>PAÍS MÁS REPRESENTADO</p>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Distribución de Contenido (Películas vs. TV)</h3>
                    <canvas id="tipoChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top 5 Países Productores</h3>
                    <canvas id="paisChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top 5 Géneros por Títulos</h3>
                    <canvas id="categoriaChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Distribución por Clasificación (Público)</h3>
                    <canvas id="publicoChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. DATASET DE EJEMPLO
        // ⚠️ DEBES REEMPLAZAR ESTE ARRAY CON TUS DATOS REALES DEL CSV.
        const netflixData = [
            {"id": "s1", "Tipo": "Movie", "nombre": "Movie A", "director": "Dir A", "protagonista": "Act 1, Act 2", "pais": "United States", "Fecha": "September 9, 2021", "año": 2020, "publico": "TV-MA", "duracion": "90 min", "categoria": "Dramas, Thrillers", "descripcion": "Desc A"},
            {"id": "s2", "Tipo": "TV Show", "nombre": "Show B", "director": "", "protagonista": "Act 3", "pais": "India", "Fecha": "August 8, 2021", "año": 2021, "publico": "TV-PG", "duracion": "1 Season", "categoria": "Comedies, International TV", "descripcion": "Desc B"},
            {"id": "s3", "Tipo": "Movie", "nombre": "Movie C", "director": "Dir C", "protagonista": "Act 4", "pais": "United States, Canada", "Fecha": "September 1, 2020", "año": 2019, "publico": "TV-MA", "duracion": "120 min", "categoria": "Dramas, Independent Movies", "descripcion": "Desc C"},
            {"id": "s4", "Tipo": "Movie", "nombre": "Movie D", "director": "Dir D", "protagonista": "Act 5", "pais": "United States", "Fecha": "September 9, 2019", "año": 2020, "publico": "R", "duracion": "85 min", "categoria": "Comedies", "descripcion": "Desc D"},
            {"id": "s5", "Tipo": "TV Show", "nombre": "Show E", "director": "", "protagonista": "Act 6", "pais": "United Kingdom", "Fecha": "July 1, 2021", "año": 2018, "publico": "TV-Y7", "duracion": "3 Seasons", "categoria": "Kids' TV, British TV", "descripcion": "Desc E"},
            {"id": "s6", "Tipo": "Movie", "nombre": "Movie F", "director": "Dir F", "protagonista": "Act 7", "pais": "Spain", "Fecha": "May 20, 2020", "año": 2020, "publico": "TV-14", "duracion": "100 min", "categoria": "Thrillers, Foreign Movies", "descripcion": "Desc F"},
            {"id": "s7", "Tipo": "Movie", "nombre": "Movie G", "director": "Dir G", "protagonista": "Act 8", "pais": "United States", "Fecha": "January 1, 2018", "año": 2017, "publico": "TV-MA", "duracion": "115 min", "categoria": "Documentaries", "descripcion": "Desc G"}
        ];

        let filteredData = [...netflixData]; // Copia inicial para filtrado
        let charts = {}; // Objeto para almacenar instancias de Chart.js

        // 2. FUNCIONES DE UTILIDAD PARA LIMPIEZA Y AGRUPACIÓN

        // Limpia la duración y devuelve solo el número de minutos
        function getDurationInMinutes(durationStr) {
            if (!durationStr || !durationStr.includes('min')) return null;
            return parseInt(durationStr.replace(' min', '').trim(), 10);
        }

        // Cuenta la frecuencia de valores en una columna (maneja listas separadas por coma)
        function getFrequencyMap(data, column) {
            const map = {};
            data.forEach(item => {
                const value = item[column];
                if (value) {
                    const parts = value.split(',').map(s => s.trim());
                    parts.forEach(part => {
                        map[part] = (map[part] || 0) + 1;
                    });
                }
            });
            return map;
        }

        // Ordena y devuelve el TOP N de un mapa
        function getTopN(map, n) {
            return Object.entries(map)
                .sort(([, a], [, b]) => b - a)
                .slice(0, n);
        }

        // 3. ACTUALIZACIÓN DE KPIS (Indicadores Clave)
        function updateKPIs(data) {
            const total = data.length;
            document.getElementById('kpi-total-titulos').textContent = total.toLocaleString();

            const movies = data.filter(d => d.Tipo === 'Movie');
            const tvShows = data.filter(d => d.Tipo === 'TV Show');

            // KPI: Porcentaje de Películas
            const percentMovies = total > 0 ? ((movies.length / total) * 100).toFixed(1) : 0;
            document.getElementById('kpi-porcentaje-movies').textContent = `${percentMovies}%`;

            // KPI: Duración Promedio (Solo Películas)
            const movieDurations = movies.map(m => getDurationInMinutes(m.duracion)).filter(d => d !== null);
            const avgDuration = movieDurations.length > 0
                ? (movieDurations.reduce((sum, d) => sum + d, 0) / movieDurations.length).toFixed(0)
                : 0;
            document.getElementById('kpi-duracion-promedio').textContent = `${avgDuration} min`;

            // KPI: País Top
            const countryMap = getFrequencyMap(data, 'pais');
            const topCountry = getTopN(countryMap, 1);
            document.getElementById('kpi-pais-top').textContent = topCountry.length > 0 ? topCountry[0][0] : 'N/A';
        }

        // 4. INICIALIZACIÓN DE FILTROS (Llenado dinámico)
        function initializeFilters() {
            const publicoValues = [...new Set(netflixData.map(d => d.publico).filter(v => v))].sort();
            const countryValues = [...new Set(netflixData.flatMap(d => d.pais ? d.pais.split(',').map(s => s.trim()) : []))].sort();
            const categoryValues = [...new Set(netflixData.flatMap(d => d.categoria ? d.categoria.split(',').map(s => s.trim()) : []))].sort();

            function populateSelect(selectId, values) {
                const select = document.getElementById(selectId);
                values.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = value;
                    select.appendChild(option);
                });
            }

            populateSelect('publicoFilter', publicoValues);
            populateSelect('paisFilter', countryValues);
            populateSelect('categoriaFilter', categoryValues);
        }

        // 5. FUNCIÓN DE FILTRADO PRINCIPAL
        function applyFilters() {
            const tipo = document.getElementById('tipoFilter').value;
            const publico = document.getElementById('publicoFilter').value;
            const pais = document.getElementById('paisFilter').value;
            const categoria = document.getElementById('categoriaFilter').value;

            filteredData = netflixData.filter(item => {
                let passes = true;

                if (tipo !== 'All' && item.Tipo !== tipo) passes = false;
                if (publico !== 'All' && item.publico !== publico) passes = false;
                if (pais !== 'All' && item.pais && !item.pais.split(',').map(s => s.trim()).includes(pais)) passes = false;
                if (categoria !== 'All' && item.categoria && !item.categoria.split(',').map(s => s.trim()).includes(categoria)) passes = false;

                return passes;
            });

            // Actualizar KPIs y Gráficos con la nueva data filtrada
            updateKPIs(filteredData);
            updateCharts(filteredData);
        }

        // 6. CREACIÓN Y ACTUALIZACIÓN DE GRÁFICOS
        function createChart(ctxId, type, data, options) {
            if (charts[ctxId]) {
                charts[ctxId].destroy();
            }
            const ctx = document.getElementById(ctxId).getContext('2d');
            charts[ctxId] = new Chart(ctx, { type, data, options });
        }

        function updateCharts(data) {
            // --- Gráfico de Tipo (Distribución) ---
            const tipoMap = getFrequencyMap(data, 'Tipo');
            const tipoData = {
                labels: Object.keys(tipoMap),
                datasets: [{
                    data: Object.values(tipoMap),
                    backgroundColor: ['#e50914', '#f5f5f5'], // Colores Netflix
                }]
            };
            createChart('tipoChart', 'pie', tipoData, { responsive: true, plugins: { legend: { position: 'right' } } });

            // --- Gráfico de Países (Top 5) ---
            const countryMap = getFrequencyMap(data, 'pais');
            const topCountries = getTopN(countryMap, 5);
            const paisData = {
                labels: topCountries.map(t => t[0]),
                datasets: [{
                    label: 'Número de Títulos',
                    data: topCountries.map(t => t[1]),
                    backgroundColor: '#e50914',
                }]
            };
            createChart('paisChart', 'bar', paisData, { responsive: true, indexAxis: 'y', plugins: { legend: { display: false } } });

            // --- Gráfico de Categorías (Top 5) ---
            const categoryMap = getFrequencyMap(data, 'categoria');
            const topCategories = getTopN(categoryMap, 5);
            const categoriaData = {
                labels: topCategories.map(t => t[0]),
                datasets: [{
                    label: 'Número de Títulos',
                    data: topCategories.map(t => t[1]),
                    backgroundColor: ['#b81f1e', '#e50914', '#ff4d4d', '#ff7878', '#ffa3a3'], // Tonos de rojo
                }]
            };
            createChart('categoriaChart', 'doughnut', categoriaData, { responsive: true, plugins: { legend: { position: 'right' } } });

            // --- Gráfico de Clasificación (Público) ---
            const publicoMap = getFrequencyMap(data, 'publico');
            const sortedPublico = Object.entries(publicoMap).sort((a, b) => b[1] - a[1]);
            const publicoData = {
                labels: sortedPublico.map(t => t[0]),
                datasets: [{
                    label: 'Conteo',
                    data: sortedPublico.map(t => t[1]),
                    backgroundColor: '#333333', // Color neutro
                }]
            };
            createChart('publicoChart', 'bar', publicoData, { responsive: true, plugins: { legend: { display: false } } });
        }

        // 7. INICIALIZACIÓN
        window.onload = function() {
            initializeFilters();
            applyFilters(); // Carga inicial con todos los datos
        };

    </script>
</body>
</html>